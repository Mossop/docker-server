#! /bin/sh

set -e

CACHE=/rhodecode/cache

URL=`cat ${CACHE}/MANIFEST | \
      sed -E -e "s/.+ //" | \
      grep $1`

LINK=$2
FILE="${LINK}.tar.gz"

aria2c -d ${CACHE} -o ${FILE} -j 10 $URL
cd /opt/rhodecode
tar -xf ${CACHE}/${FILE}
mv -n APP/store/* store
ln -s `cat APP/install_path` ${CACHE}/${LINK}
rm -rf APP ${CACHE}/${FILE}
